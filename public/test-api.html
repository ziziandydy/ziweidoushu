<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>紫微斗數 API 測試</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">紫微斗數 API 功能測試</h1>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">測試輸入</h2>
            <div class="grid grid-cols-2 gap-4">
                <input id="test-name" class="p-2 border rounded" placeholder="姓名" value="王小明">
                <select id="test-gender" class="p-2 border rounded">
                    <option value="M">男</option>
                    <option value="F">女</option>
                </select>
                <input id="test-year" class="p-2 border rounded" placeholder="出生年" type="number" value="1990">
                <input id="test-month" class="p-2 border rounded" placeholder="出生月" type="number" min="1" max="12"
                    value="5">
                <input id="test-day" class="p-2 border rounded" placeholder="出生日" type="number" min="1" max="31"
                    value="15">
                <select id="test-hour" class="p-2 border rounded">
                    <option value="子時">子時</option>
                    <option value="丑時">丑時</option>
                    <option value="寅時">寅時</option>
                    <option value="卯時">卯時</option>
                    <option value="辰時">辰時</option>
                    <option value="巳時">巳時</option>
                    <option value="午時" selected>午時</option>
                    <option value="未時">未時</option>
                    <option value="申時">申時</option>
                    <option value="酉時">酉時</option>
                    <option value="戌時">戌時</option>
                    <option value="亥時">亥時</option>
                </select>
            </div>
            <div class="mt-4">
                <select id="test-calendar" class="p-2 border rounded">
                    <option value="lunar">農曆</option>
                    <option value="solar" selected>西曆</option>
                </select>
                <label class="ml-2">
                    <input id="test-leap" type="checkbox" class="mr-1"> 潤月
                </label>
            </div>
            <button onclick="testCalculation()" class="mt-4 bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600">
                測試計算
            </button>
        </div>

        <div id="test-results" class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">測試結果</h2>
            <div id="result-content" class="text-gray-500">點擊「測試計算」查看結果...</div>
        </div>
    </div>

    <script src="./api/destiny-calculator.js"></script>
    <script>
        function testCalculation() {
            const userInput = {
                name: document.getElementById('test-name').value,
                gender: document.getElementById('test-gender').value,
                birthYear: parseInt(document.getElementById('test-year').value),
                birthMonth: parseInt(document.getElementById('test-month').value),
                birthDay: parseInt(document.getElementById('test-day').value),
                birthHour: document.getElementById('test-hour').value,
                calendarType: document.getElementById('test-calendar').value,
                isLeapMonth: document.getElementById('test-leap').checked
            };

            const resultContent = document.getElementById('result-content');
            resultContent.innerHTML = '<div class="animate-spin inline-block w-4 h-4 border-2 border-blue-500 rounded-full"></div> 計算中...';

            setTimeout(() => {
                try {
                    if (typeof ZiweiCalculatorAPI !== 'undefined') {
                        const result = ZiweiCalculatorAPI.calculateDestiny(userInput);
                        displayResult(result);
                    } else {
                        resultContent.innerHTML = '<div class="text-red-500">❌ ZiweiCalculatorAPI 未載入</div>';
                    }
                } catch (error) {
                    resultContent.innerHTML = `<div class="text-red-500">❌ 計算錯誤: ${error.message}</div>`;
                }
            }, 1000);
        }

        function displayResult(result) {
            const resultContent = document.getElementById('result-content');

            if (result.success) {
                resultContent.innerHTML = `
                    <div class="space-y-4">
                        <div class="text-green-600 font-semibold">✅ 計算成功！</div>
                        
                        <div class="bg-gray-50 p-4 rounded">
                            <h3 class="font-bold mb-2">使用者資訊</h3>
                            <p>姓名: ${result.userInfo.name}</p>
                            <p>性別: ${result.userInfo.gender === 'M' ? '男' : '女'}</p>
                            <p>出生: ${result.userInfo.birthYear}年${result.userInfo.birthMonth}月${result.userInfo.birthDay}日 ${result.userInfo.birthHour}</p>
                            <p>曆法: ${result.userInfo.calendarType === 'lunar' ? '農曆' : '西曆'}</p>
                        </div>

                        <div class="bg-gray-50 p-4 rounded">
                            <h3 class="font-bold mb-2">曆法資訊</h3>
                            <p>西曆: ${result.calendarInfo.solar.year}/${result.calendarInfo.solar.month}/${result.calendarInfo.solar.day}</p>
                            <p>農曆: ${result.calendarInfo.lunar.year}/${result.calendarInfo.lunar.month}/${result.calendarInfo.lunar.day} ${result.calendarInfo.lunar.isLeapMonth ? '(潤月)' : ''}</p>
                        </div>

                        <div class="bg-gray-50 p-4 rounded">
                            <h3 class="font-bold mb-2">命盤資訊</h3>
                            <p>五行: ${result.destinyInfo.element}</p>
                            <p>命主星: ${result.destinyInfo.destinyMaster.name} (能量: ${result.destinyInfo.destinyMaster.energyLevel})</p>
                            <p>身主星: ${result.destinyInfo.bodyMaster.name} (能量: ${result.destinyInfo.bodyMaster.energyLevel})</p>
                        </div>

                        <div class="bg-gray-50 p-4 rounded">
                            <h3 class="font-bold mb-2">十二宮配置</h3>
                            <div class="grid grid-cols-2 gap-2">
                                ${result.destinyInfo.palaces.map(palace =>
                    `<div class="text-sm">
                                        <strong>${palace.palaceName}:</strong> 
                                        ${palace.majorStars.map(star =>
                        `${star.name}(${star.energyLevel})`
                    ).join(', ') || '無主星'}
                                     </div>`
                ).join('')}
                            </div>
                        </div>

                        <div class="text-green-600 text-sm">
                            🎉 API 整合成功！所有功能正常運作。
                        </div>
                    </div>
                `;
            } else {
                resultContent.innerHTML = `
                    <div class="text-red-500">
                        <strong>❌ 計算失敗:</strong> ${result.error}
                    </div>
                `;
            }
        }

        // 檢查 API 載入狀態
        window.addEventListener('load', () => {
            if (typeof ZiweiCalculatorAPI !== 'undefined') {
                console.log('✅ ZiweiCalculatorAPI 載入成功');
            } else {
                console.error('❌ ZiweiCalculatorAPI 載入失敗');
            }
        });
    </script>
</body>

</html>
