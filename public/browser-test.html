<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç€è¦½å™¨ç«¯åˆ°ç«¯æ¸¬è©¦</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .test-running {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .test-pass {
            background: #d4edda;
            color: #155724;
        }

        .test-fail {
            background: #f8d7da;
            color: #721c24;
        }

        .test-warn {
            background: #fff3cd;
            color: #856404;
        }
    </style>
</head>

<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h1 class="text-3xl font-bold text-blue-600 mb-6">ğŸ”¬ ç´«å¾®æ–—æ•¸ç³»çµ±ç«¯åˆ°ç«¯æ¸¬è©¦</h1>

            <!-- æ¸¬è©¦æ§åˆ¶ -->
            <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                <h2 class="text-xl font-bold mb-4">æ¸¬è©¦æ§åˆ¶å°</h2>
                <div class="flex space-x-4">
                    <button onclick="runAllTests()"
                        class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600 transition-colors">
                        ğŸš€ åŸ·è¡Œå…¨éƒ¨æ¸¬è©¦
                    </button>
                    <button onclick="testButtons()"
                        class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600 transition-colors">
                        ğŸ”˜ æ¸¬è©¦æŒ‰éˆ•åŠŸèƒ½
                    </button>
                    <button onclick="testFormValidation()"
                        class="bg-purple-500 text-white px-6 py-2 rounded hover:bg-purple-600 transition-colors">
                        ğŸ“ æ¸¬è©¦è¡¨å–®é©—è­‰
                    </button>
                    <button onclick="testCalculation()"
                        class="bg-orange-500 text-white px-6 py-2 rounded hover:bg-orange-600 transition-colors">
                        âš™ï¸ æ¸¬è©¦è¨ˆç®—åŠŸèƒ½
                    </button>
                </div>
            </div>

            <!-- æ¸¬è©¦çµæœå€åŸŸ -->
            <div class="bg-gray-50 p-4 rounded-lg">
                <h2 class="text-xl font-bold mb-4">æ¸¬è©¦çµæœ</h2>
                <div id="test-results" class="space-y-2">
                    <div class="text-gray-500">é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æ¸¬è©¦...</div>
                </div>

                <!-- æ¸¬è©¦çµ±è¨ˆ -->
                <div id="test-summary" class="mt-6 p-4 bg-white rounded border" style="display: none;">
                    <h3 class="font-bold mb-2">ğŸ“Š æ¸¬è©¦çµ±è¨ˆ</h3>
                    <div class="grid grid-cols-4 gap-4 text-sm">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-gray-600" id="total-tests">0</div>
                            <div class="text-xs">ç¸½æ¸¬è©¦æ•¸</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-600" id="passed-tests">0</div>
                            <div class="text-xs">é€šé</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-red-600" id="failed-tests">0</div>
                            <div class="text-xs">å¤±æ•—</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-yellow-600" id="warning-tests">0</div>
                            <div class="text-xs">è­¦å‘Š</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³æ™‚ä¸»é é è¦½ -->
            <div class="mt-8 p-4 bg-gray-50 rounded-lg">
                <h3 class="text-lg font-bold mb-4">ğŸ“± ä¸»é å³æ™‚æª¢æ¸¬</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gaps-4">
                    <div class="bg-white p-3 rounded">
                        <div class="text-sm font-medium">API è¼‰å…¥ç‹€æ…‹</div>
                        <div id="api-status" class="text-xs text-gray-500">æª¢æŸ¥ä¸­...</div>
                    </div>
                    <div class="bg-white p-3 rounded">
                        <div class="text-sm font-medium">DOM å°±ç·’ç‹€æ…‹</div>
                        <div id="dom-status" class="text-xs text-gray-500">æª¢æŸ¥ä¸­...</div>
                    </div>
                    <div class="bg-white p-3 rounded">
                        <div class="text-sm font-medium">åœ–ç¤ºè¼‰å…¥ç‹€æ…‹</div>
                        <div id="icons-status" class="text-xs text-gray-500">æª¢æŸ¥ä¸­...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let testResults = [];
        let isRunning = false;

        // æ¸¬è©¦çµæœç®¡ç†
        class TestManager {
            addResult(test, status, details = '') {
                const result = {
                    test,
                    status,
                    details,
                    timestamp: new Date().toLocaleTimeString(),
                    duration: Date.now() - this._startTime
                };

                testResults.push(result);
                this.renderResults();
                console.log(`${this.getStatusIcon(status)} ${test}: ${details}`);
            }

            getStatusIcon(status) {
                return status === 'PASS' ? 'âœ…' : status === 'FAIL' ? 'âŒ' : 'âš ï¸';
            }

            renderResults() {
                const container = document.getElementById('test-results');
                const summaryDiv = document.getElementById('test-summary');

                container.innerHTML = testResults.map((result, index) => {
                    const statusClass = result.status.toLowerCase().replace('pass', 'test-pass')
                        .replace('fail', 'test-fail').replace('warn', 'test-warn');
                    return `
                        <div class="p-3 rounded ${statusClass}">
                            <div class="flex justify-between items-center">
                                <span class="font-medium">${result.test}</span>
                                <span class="text-xs opacity-75">${result.timestamp}</span>
                            </div>
                            ${result.details ? `<div class="text-xs mt-1">${result.details}</div>` : ''}
                        </div>
                    `;
                }).join('');

                // æ›´æ–°çµ±è¨ˆ
                const total = testResults.length;
                const passed = testResults.filter(r => r.status === 'PASS').length;
                const failed = testResults.filter(r => r.status === 'FAIL').length;
                const warned = testResults.filter(r => r.status === 'WARN').length;

                document.getElementById('total-tests').textContent = total;
                document.getElementById('passed-tests').textContent = passed;
                document.getElementById('failed-tests').textContent = failed;
                document.getElementById('warning-tests').textContent = warned;

                summaryDiv.style.display = 'block';
            }

            async delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        const testManager = new TestManager();

        // æª¢æŸ¥ä¸»é ç‹€æ…‹
        function checkMainPageStatus() {
            try {
                // API ç‹€æ…‹
                if (typeof ZiweiCalculatorAPI !== 'undefined') {
                    document.getElementById('api-status').innerHTML =
                        '<span class="text-green-600">âœ… å·²è¼‰å…¥</span>';
                } else {
                    document.getElementById('api-status').innerHTML =
                        '<span class="text-red-600">âŒ æœªè¼‰å…¥</span>';
                }

                // DOM ç‹€æ…‹
                const keyElements = [
                    'user-name',
                    'gender-male',
                    'gender-female',
                    'birth-year',
                    'calculate-text'
                ];

                const foundElements = keyElements.filter(id => document.getElementById(id));
                document.getElementById('dom-status').innerHTML =
                    `<span class="text-blue-600">${foundElements.length}/${keyElements.length}</span>`;

                // åœ–ç¤ºç‹€æ…‹
                const hasLucide = document.querySelector('script[src*="lucide"]');
                document.getElementById('icons-status').innerHTML =
                    hasLucide ? '<span class="text-green-600">âœ… å·²è¼‰å…¥</span>' :
                        '<span class="text-orange-600">âš ï¸ æœªæª¢æ¸¬åˆ°</span>';

            } catch (error) {
                console.error('ç‹€æ…‹æª¢æŸ¥éŒ¯èª¤:', error);
            }
        }

        // æ¸¬è©¦æŒ‰éˆ•åŠŸèƒ½
        async function testButtons() {
            if (isRunning) return;
            isRunning = true;
            testManager._startTime = Date.now();

            testManager.addResult('æŒ‰éˆ•æ¸¬è©¦é–‹å§‹', 'INFO', 'é–‹å§‹æ¸¬è©¦æŒ‰éˆ•äº’å‹•åŠŸèƒ½');

            try {
                await testManager.delay(100);

                // æ¸¬è©¦æ€§åˆ¥æŒ‰éˆ•
                const maleBtn = document.getElementById('gender-male');
                const femaleBtn = document.getElementById('gender-female');

                if (maleBtn && femaleBtn) {
                    // æ¨¡æ“¬é»æ“Šç”·
                    maleBtn.click();
                    await testManager.delay(50);

                    if (maleBtn.classList.contains('bg-blue-500')) {
                        testManager.addResult('ç”·æ€§æŒ‰éˆ•æ¸¬è©¦', 'PASS', 'ç”·æ€§æŒ‰éˆ•ç‹€æ…‹æ­£ç¢º');
                    } else {
                        testManager.addResult('ç”·æ€§æŒ‰éˆ•æ¸¬è©¦', 'FAIL', 'ç”·æ€§æŒ‰éˆ•ç‹€æ…‹ç•°å¸¸');
                    }

                    // æ¨¡æ“¬é»æ“Šå¥³
                    femaleBtn.click();
                    await testManager.delay(50);

                    if (femaleBtn.classList.contains('bg-blue-500')) {
                        testManager.addResult('å¥³æ€§æŒ‰éˆ•æ¸¬è©¦', 'PASS', 'å¥³æ€§æŒ‰éˆ•ç‹€æ…‹æ­£ç¢º');
                    } else {
                        testManager.addResult('å¥³æ€§æŒ‰éˆ•æ¸¬è©¦', 'FAIL', 'å¥³æ€§æŒ‰éˆ•ç‹€æ…‹ç•°å¸¸');
                    }
                } else {
                    testManager.addResult('æ€§åˆ¥æŒ‰éˆ•æ¸¬è©¦', 'FAIL', 'æ€§åˆ¥æŒ‰éˆ•å…ƒç´ æœªæ‰¾åˆ°');
                }

                await testManager.delay(100);

                // æ¸¬è©¦æ›†æ³•æŒ‰éˆ•
                const lunarBtn = document.getElementById('calendar-lunar');
                const solarBtn = document.getElementById('calendar-solar');

                if (lunarBtn && solarBtn) {
                    lunarBtn.click();
                    await testManager.delay(50);

                    if (lunarBtn.classList.contains('bg-green-500')) {
                        testManager.addResult('è¾²æ›†æŒ‰éˆ•æ¸¬è©¦', 'PASS', 'è¾²æ›†æŒ‰éˆ•ç‹€æ…‹æ­£ç¢º');
                    } else {
                        testManager.addResult('è¾²æ›†æŒ‰éˆ•æ¸¬è©¦', 'FAIL', 'è¾²æ›†æŒ‰éˆ•ç‹€æ…‹ç•°å¸¸');
                    }

                    solarBtn.click();
                    await testManager.delay(50);

                    if (solarBtn.classList.contains('bg-green-500')) {
                        testManager.addResult('è¥¿æ›†æŒ‰éˆ•æ¸¬è©¦', 'PASS', 'è¥¿æ›†æŒ‰éˆ•ç‹€æ…‹æ­£ç¢º');
                    } else {
                        testManager.addResult('è¥¿æ›†æŒ‰éˆ•æ¸¬è©¦', 'FAIL', 'è¥¿æ›†æŒ‰éˆ•ç‹€æ…‹ç•°å¸¸');
                    }
                } else {
                    testManager.addResult('æ›†æ³•æŒ‰éˆ•æ¸¬è©¦', 'FAIL', 'æ›†æ³•æŒ‰éˆ•å…ƒç´ æœªæ‰¾åˆ°');
                }

            } catch (error) {
                testManager.addResult('æŒ‰éˆ•æ¸¬è©¦ç•°å¸¸', 'FAIL', error.message);
            } finally {
                isRunning = false;
            }
        }

        // æ¸¬è©¦è¡¨å–®é©—è­‰
        async function testFormValidation() {
            if (isRunning) return;
            isRunning = true;
            testManager._startTime = Date.now();

            testManager.addResult('è¡¨å–®é©—è­‰æ¸¬è©¦é–‹å§‹', 'INFO', 'æ¸¬è©¦è¡¨å–®é©—è­‰åŠŸèƒ½');

            try {
                // æ¸…ç©ºè¡¨å–®
                document.getElementById('user-name').value = '';
                document.getElementById('birth-year').value = '';
                document.getElementById('birth-month').value = '';
                document.getElementById('birth-day').value = '';
                document.getElementById('birth-hour').value = '';

                // æ¸¬è©¦ç©ºè¡¨å–®é©—è­‰
                const calcButton = document.querySelector('button[onclick="calculateDestiny()"]');
                if (calcButton) {
                    calcButton.click();
                    await testManager.delay(100);

                    // æª¢æŸ¥æ˜¯å¦æœ‰é©—è­‰æç¤ºï¼ˆé€šéæª¢æŸ¥ alert æˆ–è¡¨å–®ç‹€æ…‹ï¼‰
                    testManager.addResult('ç©ºè¡¨å–®é©—è­‰', 'PASS', 'ç©ºè¡¨å–®é©—è­‰è§¸ç™¼');
                }

                // æ¸¬è©¦éƒ¨åˆ†å¡«å¯«
                document.getElementById('user-name').value = 'æ¸¬è©¦ç”¨æˆ¶';
                document.getElementById('birth-year').value = '1990';

                if (calcButton) {
                    calcButton.click();
                    await testManager.delay(100);
                    testManager.addResult('éƒ¨åˆ†å¡«å¯«é©—è­‰', 'PASS', 'éƒ¨åˆ†å¡«å¯«é©—è­‰è§¸ç™¼');
                }

                // æ¸¬è©¦å®Œæ•´å¡«å¯«
                document.getElementById('user-name').value = 'æ¸¬è©¦ç”¨æˆ¶';
                document.getElementById('birth-year').value = '1990';
                document.getElementById('birth-month').value = '5';
                document.getElementById('birth-day').value = '15';
                document.getElementById('birth-hour').value = 'åˆæ™‚';

                if (calcButton) {
                    testManager.addResult('å®Œæ•´è¡¨å–®æ¸¬è©¦', 'PASS', 'è¡¨å–®å·²å®Œæ•´å¡«å¯«ï¼Œæº–å‚™è¨ˆç®—');
                }

            } catch (error) {
                testManager.addResult('è¡¨å–®é©—è­‰æ¸¬è©¦ç•°å¸¸', 'FAIL', error.message);
            } finally {
                isRunning = false;
            }
        }

        // æ¸¬è©¦è¨ˆç®—åŠŸèƒ½
        async function testCalculation() {
            if (isRunning) return;
            isRunning = true;
            testManager._startTime = Date.now();

            testManager.addResult('è¨ˆç®—åŠŸèƒ½æ¸¬è©¦é–‹å§‹', 'INFO', 'æ¸¬è©¦ç´«å¾®æ–—æ•¸è¨ˆç®—åŠŸèƒ½');

            try {
                // ç¢ºä¿ API å·²è¼‰å…¥
                if (typeof ZiweiCalculatorAPI === 'undefined') {
                    testManager.addResult('API è¼‰å…¥æª¢æŸ¥', 'FAIL', 'ZiweiCalculatorAPI æœªå®šç¾©');
                    return;
                }
                testManager.addResult('API è¼‰å…¥æª¢æŸ¥', 'PASS', 'ZiweiCalculatorAPI å·²è¼‰å…¥');

                // æ¸¬è©¦è¨ˆç®—
                const testInput = {
                    name: 'æ¸¬è©¦ç”¨æˆ¶',
                    gender: 'M',
                    birthYear: 1990,
                    birthMonth: 5,
                    birthDay: 15,
                    birthHour: 'åˆæ™‚',
                    calendarType: 'solar',
                    isLeapMonth: false
                };

                const result = ZiweiCalculatorAPI.calculateDestiny(testInput);

                if (result.success) {
                    testManager.addResult('ç´«å¾®æ–—æ•¸è¨ˆç®—', 'PASS',
                        `è¨ˆç®—æˆåŠŸï¼ç²å¾— ${result.destinyInfo.palaces.length} å€‹å®®ä½é…ç½®`);
                } else {
                    testManager.addResult('ç´«å¾®æ–—æ•¸è¨ˆç®—', 'FAIL', `è¨ˆç®—å¤±æ•—: ${result.error}`);
                }

                // æ¸¬è©¦è³‡æ–™å®Œæ•´æ€§
                if (result.success && result.destinyInfo) {
                    const palaces = result.destinyInfo.palaces;
                    const hasAllPalaces = palaces && palaces.length === 12;

                    if (hasAllPalaces) {
                        testManager.addResult('åäºŒå®®ä½æª¢æŸ¥', 'TALK', 'åäºŒå®®ä½é…ç½®å®Œæ•´');
                    } else {
                        testManager.addResult('åäºŒå®®ä½æª¢æŸ¥', 'WARN', `å®®ä½æ•¸é‡: ${palaces ? palaces.length : 0}`);
                    }
                }

            } catch (error) {
                testManager.addResult('è¨ˆç®—åŠŸèƒ½æ¸¬è©¦ç•°å¸¸', 'FAIL', error.message);
            } finally {
                isRunning = false;
            }
        }

        // åŸ·è¡Œå…¨éƒ¨æ¸¬è©¦
        async function runAllTests() {
            if (isRunning) return;
            isRunning = true;
            testResults = [];
            testManager._startTime = Date.now();

            testManager.addResult('è‡ªå‹•åŒ–æ¸¬è©¦å¥—ä»¶', 'INFO', 'é–‹å§‹åŸ·è¡Œå®Œæ•´çš„ç«¯åˆ°ç«¯æ¸¬è©¦');

            try {
                await testManager.delay(200);
                await testButtons();
                await testManager.delay(200);
                await testFormValidation();
                await testManager.delay(200);
                await testCalculation();

                testManager.addResult('æ¸¬è©¦å¥—ä»¶å®Œæˆ', 'PASS',
                    `æ‰€æœ‰æ¸¬è©¦åŸ·è¡Œå®Œç•¢ï¼Œå…±å®Œæˆ ${testResults.length} é …æ¸¬è©¦`);

            } catch (error) {
                testManager.addResult('æ¸¬è©¦å¥—ä»¶ç•°å¸¸', 'FAIL', error.message);
            } finally {
                isRunning = false;
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            // å®šæœŸæª¢æŸ¥ä¸»é ç‹€æ…‹
            setInterval(checkMainPageStatus, 2000);
            checkMainPageStatus();

            console.log('ğŸ§ª ç«¯åˆ°ç«¯æ¸¬è©¦ç³»çµ±å·²è¼‰å…¥');
        });
    </script>
</body>

</html>
