<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç´«å¾®æ–—æ•¸ç³»çµ±å®Œæ•´æ¸¬è©¦</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen p-6">
    <div class="max-w-6xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h1 class="text-3xl font-bold mb-6 text-center text-green-600">ğŸ§ª ç´«å¾®æ–—æ•¸ç³»çµ±å®Œæ•´æ¸¬è©¦</h1>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="font-bold text-blue-700 mb-2">æ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦</h3>
                    <button onclick="runCoreTests()"
                        class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">åŸ·è¡Œæ¸¬è©¦</button>
                </div>
                <div class="bg-green-50 p-4 rounded-lg">
                    <h3 class="font-bold text-green-700 mb-2">API æ•´åˆæ¸¬è©¦</h3>
                    <button onclick="runAPITests()"
                        class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">åŸ·è¡Œæ¸¬è©¦</button>
                </div>
                <div class="bg-purple-50 p-4 rounded-lg">
                    <h3 class="font-bold text-purple-700 mb-2">ç•Œé¢åŠŸèƒ½æ¸¬è©¦</h3>
                    <button onclick="runUITests()"
                        class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">åŸ·è¡Œæ¸¬è©¦</button>
                </div>
            </div>

            <div class="bg-gray-50 p-4 rounded-lg">
                <h3 class="font-bold mb-4">æ¸¬è©¦çµæœ</h<ï½œtoolâ–sepï½œ>3>
                    <div id="test-results" class="space-y-2">
                        <div class="text-gray-500">ç­‰å¾…æ¸¬è©¦åŸ·è¡Œ...</div>
                    </div>
            </div>
        </div>

        <!-- åŠŸèƒ½æ¸¬è©¦èªªæ˜ -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold mb-4">ğŸ“‹ æ¸¬è©¦é …ç›®æª¢æŸ¥æ¸…å–®</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-bold mb-3 text-blue-600">ğŸ”§ æ ¸å¿ƒåŠŸèƒ½</h3>
                    <ul class="space-y-2 text-sm">
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>é é¢è¼‰å…¥æ­£å¸¸</li>
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>è¡¨å–®é©—è­‰åŠŸèƒ½</li>
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>æŒ‰éˆ•äº’å‹•ç‹€æ…‹</li>
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>æ­¥é©Ÿåˆ‡æ›åŠŸèƒ½</li>
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>æ—¥æœŸé¸æ“‡å™¨</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold mb-3 text-green-600">âš™ï¸ API åŠŸèƒ½</h3>
                    <ul class="space-y-2 text-sm">
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>API è¼‰å…¥ç‹€æ…‹
                        </li>
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>ç´«å¾®æ–—æ•¸è¨ˆç®—</li>
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>æ›†æ³•è½‰æ›åŠŸèƒ½</li>
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>æ˜Ÿæ›œè³‡æ–™åº«</li>
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>éŒ¯èª¤è™•ç†æ©Ÿåˆ¶</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold mb-3 text-purple-600">ğŸ¨ ç•Œé¢åŠŸèƒ½</h3>
                    <ul class="space-y-2 text-sm">
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>è¼‰å…¥å‹•ç•«æ•ˆæœ</li>
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>æ˜Ÿæ›œèƒ½é‡é¡¯ç¤º</li>
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>è‰²å½©é…ç½®æ­£ç¢º</li>
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>éŸ¿æ‡‰å¼è¨­è¨ˆ</li>
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>è³‡æ–™å®Œæ•´æ€§</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold mb-3 text-orange-600">ğŸŒŸ ç´«å¾®æ–—æ•¸å°ˆæ¥­</h3>
                    <ul class="space-y-2 text-sm">
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>ä¸­å·æ´¾ç†è«–</li>
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>åäºŒå®®ä½é…ç½®</li>
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>ä¸»æ˜Ÿåˆ†ä½ˆè¦å‰‡</li>
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>äº”è¡Œå±€è¨ˆç®—</li>
                        <li class="flex items-center"><span class="w-4 h-4 bg-gray-200 rounded mr-2"></span>å‘½èº«ä¸»æ˜Ÿ</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="./public/api/destiny-calculator.js"></script>
    <script>
        let testResults = [];

        class SystemTester {
            constructor() {
                this.startTime = Date.now();
            }

            addResult(test, status, details = '') {
                const statusIcon = status === 'PASS' ? 'âœ…' : status === 'FAIL' ? 'âŒ' : 'âš ï¸';
                testResults.push({
                    test,
                    status,
                    details,
                    timestamp: new Date().toLocaleTimeString()
                });
                this.renderResults();
            }

            renderResults() {
                const container = document.getElementById('test-results');
                container.innerHTML = testResults.map(result => `
                    <div class="flex items-center justify-between p-2 ${this.getStatusColor(result.status)} rounded">
                        <span class="flex items-center">
                            ${this.getStatusIcon(result.status)} ${result.test}
                        </span>
                        <span class="text-xs text-gray-500">${result.timestamp}</span>
                    </div>
                    ${result.details ? `<div class="text-xs text-gray-600 ml-6 mb-1">${result.details}</div>` : ''}
                `).join('');
            }

            getStatusIcon(status) {
                return status === 'PASS' ? 'âœ…' : status === 'FAIL' ? 'âŒ' : 'âš ï¸';
            }

            getStatusColor(status) {
                return status === 'PASS' ? 'bg-green-50' : status === 'FAIL' ? 'bg-red-50' : 'bg-yellow-50';
            }

            async delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            runCoreTests() {
                document.getElementById('test-results').innerHTML = '<div class="text-blue-600">ğŸ”„ åŸ·è¡Œæ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦...</div>';

                setTimeout(async () => {
                    // æ¸¬è©¦é é¢è¼‰å…¥
                    this.addResult('é é¢è¼‰å…¥æ¸¬è©¦', 'PASS', 'HTML çµæ§‹å®Œæ•´è¼‰å…¥');
                    await this.delay(100);

                    // æ¸¬è©¦è¡¨å–®å…ƒç´ å­˜åœ¨
                    const userNameInput = document.querySelector('#user-name');
                    if (userNameInput) {
                        this.addResult('è¡¨å–®å…ƒç´ æª¢æŸ¥', 'PASS', 'æ‰€æœ‰å¿…å¡«æ¬„ä½å­˜åœ¨');
                    } else {
                        this.addResult('è¡¨å–®å…ƒç´ æª¢æŸ¥', 'FAIL', 'é—œéµè¡¨å–®å…ƒç´ ç¼ºå¤±');
                    }
                    await this.delay(100);

                    // æ¸¬è©¦æŒ‰éˆ•äº’å‹•
                    const calcButton = document.querySelector('button[onclick="calculateDestiny()"]');
                    if (calcButton) {
                        this.addResult('æŒ‰éˆ•äº’å‹•æ¸¬è©¦', 'PASS', 'è¨ˆç®—æŒ‰éˆ•å­˜åœ¨ä¸”å¯ç”¨');
                    } else {
                        this.addResult('æŒ‰éˆ•äº’å‹•æ¸¬è©¦', 'FAIL', 'è¨ˆç®—æŒ‰éˆ•ç¼ºå¤±');
                    }
                    await this.delay(100);

                    // æ¸¬è©¦æ­¥é©Ÿåˆ‡æ›
                    const step1 = document.getElementById('step-content-1');
                    const step2 = document.getElementById('step-content-2');
                    if (step1 && step2) {
                        this.addResult('æ­¥é©Ÿåˆ‡æ›åŠŸèƒ½', 'PASS', 'ä¸‰æ­¥é©Ÿç•Œé¢çµæ§‹å®Œæ•´');
                    } else {
                        this.addResult('æ­¥é©Ÿåˆ‡æ›åŠŸèƒ½', 'FAIL', 'æ­¥é©Ÿæ§åˆ¶å…ƒç´ ç¼ºå¤±');
                    }

                    this.showSummary();
                }, 500);
            }

            runAPITests() {
                setTimeout(async () => {
                    try {
                        // æ¸¬è©¦ API è¼‰å…¥
                        if (typeof ZiweiCalculatorAPI !== 'undefined') {
                            this.addResult('API è¼‰å…¥æ¸¬è©¦', 'PASS', 'ZiweiCalculatorAPI æˆåŠŸè¼‰å…¥');
                        } else {
                            this.addResult('API è¼‰å…¥æ¸¬è©¦', 'FAIL', 'ZiweiCalculatorAPI æœªå®šç¾©');
                            return;
                        }
                        await this.delay(200);

                        // æ¸¬è©¦è¨ˆç®—åŠŸèƒ½
                        const testInput = {
                            name: 'æ¸¬è©¦ç”¨æˆ¶',
                            gender: 'M',
                            birthYear: 1990,
                            birthMonth: 5,
                            birthDay: 15,
                            birthHour: 'åˆæ™‚',
                            calendarType: 'solar',
                            isLeapMonth: false
                        };

                        try {
                            const result = ZiweiCalculatorAPI.calculateDestiny(testInput);
                            if (result.success) {
                                this.addResult('ç´«å¾®æ–—æ•¸è¨ˆç®—', 'PASS', `è¨ˆç®—æˆåŠŸï¼Œç²å¾— ${result.destinyInfo.palaces.length} å€‹å®®ä½è³‡æ–™`);
                            } else {
                                this.addResult('ç´«å¾®æ–—æ•¸è¨ˆç®—', 'FAIL', `è¨ˆç®—å¤±æ•—: ${result.error}`);
                            }
                        } catch (error) {
                            this.addResult('ç´«å¾®æ–—æ•¸è¨ˆç®—', 'FAIL', `è¨ˆç®—ç•°å¸¸: ${error.message}`);
                        }
                        await this.delay(200);

                        // æ¸¬è©¦æ›†æ³•åŠŸèƒ½
                        if (result && result.calendarInfo) {
                            this.addResult('æ›†æ³•è½‰æ›åŠŸèƒ½', 'PASS', 'è¾²æ›†è¥¿æ›†è½‰æ›æ­£å¸¸');
                        } else {
                            this.addResult('æ›†æ³•è½‰æ›åŠŸèƒ½', 'WARN', 'æ›†æ³•è½‰æ›åŠŸèƒ½éœ€æª¢æŸ¥');
                        }

                        this.showSummary();
                    } catch (error) {
                        this.addResult('API æ¸¬è©¦ç•°å¸¸', 'FAIL', error.message);
                    }
                }, 100);
            }

            runUITests() {
                setTimeout(async () => {
                    // æ¸¬è©¦ CSS è¼‰å…¥
                    const hasTailwind = document.querySelector('script[src*="tailwind"]');
                    if (hasTailwind) {
                        this.addResult('CSS æ¡†æ¶è¼‰å…¥', 'PASS', 'Tailwind CSS å·²è¼‰å…¥');
                    } else {
                        this.addResult('CSS æ¡†æ¶è¼‰å…¥', 'WARN', 'CSS æ¡†æ¶ç‹€æ…‹æœªçŸ¥');
                    }
                    await this.delay(100);

                    // æ¸¬è©¦å‹•ç•«æ•ˆæœ
                    const hasAnimations = document.querySelector('.animate-fade-in, .hover-lift');
                    if (hasAnimations) {
                        this.addResult('å‹•ç•«æ•ˆæœæª¢æŸ¥', 'PASS', 'CSS å‹•ç•«é¡å·²å®šç¾©');
                    } else {
                        this.addResult('å‹•ç•«æ•ˆæœæª¢æŸ¥', 'WARN', 'å‹•ç•«æ•ˆæœå¯èƒ½éœ€è¦èª¿æ•´');
                    }
                    await this.delay(100);

                    // æ¸¬è©¦è¼‰å…¥ç‹€æ…‹
                    const loadingSpinner = document.getElementById('loading-spinner');
                    if (loadingSpinner) {
                        this.addResult('è¼‰å…¥ç‹€æ…‹åŠŸèƒ½', 'PASS', 'è¼‰å…¥å‹•ç•«å…ƒç´ å­˜åœ¨');
                    } else {
                        this.addResult('è¼‰å…¥ç‹€æ…‹åŠŸèƒ½', 'FAIL', 'è¼‰å…¥å‹•ç•«å…ƒç´ ç¼ºå¤±');
                    }

                    // æ¸¬è©¦åœ–ç¤ºç³»çµ±
                    const lucideScript = document.querySelector('script[src*="lucide"]');
                    if (lucideScript) {
                        this.addResult('åœ–ç¤ºç³»çµ±è¼‰å…¥', 'PASS', 'Lucide Icons å·²è¼‰å…¥');
                    } else {
                        this.addResult('åœ–ç¤ºç³»çµ±è¼‰å…¥', 'WARN', 'åœ–ç¤ºç³»çµ±ç‹€æ…‹æœªçŸ¥');
                    }

                    this.showSummary();
                }, 100);
            }

            showSummary() {
                const totalTests = testResults.length;
                const passedTests = testResults.filter(r => r.status === 'PASS').length;
                const failedTests = testResults.filter(r => r.status === 'FAIL').length;
                const warnedTests = testResults.filter(r => r.status === 'WARN').length;

                setTimeout(() => {
                    const summary = document.createElement('div');
                    summary.className = 'mt-4 p-4 bg-gray-100 rounded-lg';
                    summary.innerHTML = `
                        <div class="font-bold mb-2">ğŸ“Š æ¸¬è©¦ç¸½çµ</div>
                        <div class="grid grid-cols-3 gap-4 text-sm">
                            <div class="text-green-600">âœ… é€šé: ${passedTests}</div>
                            <div class="text-red-600">âŒ å¤±æ•—: ${failedTests}</div>
                            <div class="text-yellow-600">âš ï¸ è­¦å‘Š: ${warnedTests}</div>
                        </div>
                        <div class="mt-2 text-xs text-gray-500">
                            ç¸½è¨ˆ ${totalTests} é …æ¸¬è©¦ â€¢ è€—æ™‚ ${Date.now() - this.startTime}ms
                        </div>
                        ${failedTests === 0 ? '<div class="mt-2 text-green-600 font-bold">ğŸ‰ ç³»çµ±æ¸¬è©¦å…¨éƒ¨é€šéï¼</div>' : ''}
                    `;
                    document.getElementById('test-results').appendChild(summary);
                }, 500);
            }
        }

        const tester = new SystemTester();

        function runCoreTests() {
            testResults = [];
            tester.runCoreTests();
        }

        function runAPITests() {
            tester.runAPITests();
        }

        function runUITests() {
            tester.runUITests();
        }

        // è‡ªå‹•åŸ·è¡Œå®Œæ•´æ¸¬è©¦
        window.addEventListener('load', () => {
            setTimeout(() => {
                runCoreTests();
                setTimeout(() => runAPITests(), 1000);
                setTimeout(() => runUITests(), 2000);
            }, 500);
        });
    </script>
</body>

</html>
